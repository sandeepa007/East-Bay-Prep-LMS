define(["jquery","core/ajax","core/templates","core/notification","core/str","core/config","core/url"],function(a,b,c,d,e,f,g){return a("body").on("click keypress","[data-inplaceeditable]",function(h){if("keypress"!==h.type||13===h.keyCode){h.stopImmediatePropagation(),h.preventDefault();var i=a(this),j=i.closest("[data-inplaceeditable]"),k=function(b){b.addClass("updating");var c=b.find("img.spinner");c.length?c.show():(c=a("<img/>").attr("src",g.imageUrl("i/loading_small")).addClass("spinner").addClass("smallicon"),b.append(c))},l=function(a){a.removeClass("updating"),a.find("img.spinner").hide()},m=function(e,f){var g=[e.attr("data-baid"),"pending"].join("-");M.util.js_pending(g),k(e),b.call([{methodname:"mod_booking_update_bookingnotes",args:{baid:e.attr("data-baid"),note:f},done:function(b){var d=e.attr("data-value");c.render("mod_booking/edit_bookingnotes",b).done(function(f,h){var i=a(f);c.replaceNode(e,i,h),i.find("[data-note]").focus(),i.trigger({type:"updated",ajaxreturn:b,oldvalue:d}),M.util.js_complete(g)})},fail:function(b){var c=a.Event("updatefailed",{exception:b,newvalue:f});l(e),M.util.js_complete(g),e.trigger(c),c.isDefaultPrevented()||d.exception(b)}}],!0)},n=function(a){a.find("textarea").off(),a.html(a.attr("data-oldcontent")),a.removeAttr("data-oldcontent"),a.removeClass("inplaceeditingon"),a.find("[data-note]").focus()},o=function(b){b.attr("data-oldcontent",b.html());var c=function(b,d){var e,f=b;for(e=0;e<d;e++)f+=String(Math.floor(10*Math.random()));return 0===a("#"+f).length?f:c(b,d)};e.get_string("edittitleinstructions").done(function(d){var e=a('<span class="editinstructions">'+d+"</span>").attr("id",c("id_editinstructions_",20)),g=a('<textarea rows="4" cols="50"></textarea>').attr("id",c("id_inplacevalue_",20)).val(b.find(".bookingnote").text()).attr("aria-describedby",e.attr("id")).addClass("ignoredirty").addClass("form-control"),h=a('<label class="accesshide">'+j.attr("data-editlabel")+"</label>").attr("for",g.attr("id"));b.html("").append(e).append(h).append(g),g.focus(),g.select(),g.on("keyup keypress focusout",function(a){if(!f.behatsiterunning||"focusout"!==a.type){if("keypress"===a.type&&13===a.keyCode){var c=g.val();n(b),m(b,c)}("keyup"===a.type&&27===a.keyCode||"focusout"===a.type)&&n(b)}})})};o(j)}}),{}});